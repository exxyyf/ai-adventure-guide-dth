# AI Adventure Guide - Исследовательская часть

## Описание проекта

Этот репозиторий содержит исследовательскую и экспериментальную часть проекта AI Adventure Guide - системы для создания интеллектуальных туристических гидов с глубоким культурным наполнением путешествий.

## Мотивация и проблема

Современные туристические приложения и гиды часто предоставляют только поверхностную информацию о достопримечательностях, ограничиваясь базовыми фактами и описаниями. Это не позволяет путешественникам по-настоящему понять культурный контекст, исторический фон и духовное значение мест, которые они посещают. 

AI Adventure Guide решает эту проблему, используя искусственный интеллект для создания персонализированных гидов, которые:
- Глубоко раскрывают культурное и историческое значение мест
- Адаптируют информацию под интересы и уровень знаний пользователя
- Предоставляют контекст, позволяющий лучше понять местные традиции и обычаи
- Создают более насыщенный и запоминающийся опыт путешествия

# Архитектура пайплайна

Список зависимостей лежит [здесь](https://github.com/exxyyf/ai-adventure-guide-dth/blob/main/team-repo/AI%20guide/pyproject.toml), используется Python 3.11 и Poetry как менеджер пакетов.

Сервис представляет собой RAG-pipeline в качестве baseline решения, который состоит из:

1. Модуля генерации ответов **Generator**:

- Скрипт generator.py
- Используемая модель: Mistral через API (mistralai пакет). Задача: на основе уточнённого вопроса и контекста выдаёт текстовый ответ.
- Системный prompt: эксперт по путешествиям
- Пользовательский prompt: добавляет retrieved_chunks + вопрос
- Ограничение длины ответа через max_tokens

2. Модуля **Retriever** - осуществляет поиск контента, скрипт retriever.py.

- Возвращает список текстов для дальнейшей генерации ответа LLM.
- Находит k наиболее релевантных контекстов и передаёт их в Generator

3. Модуля **Preprocessing**, который отвечает за понимание сути вопроса:

- Принимает вопрос пользователя и, используя модель MISTRAL, понимает суть вопроса, намерение пользователя и переформулирует вопрос

4. **API / Backend** - обработка запроса, поиск по векторному индексу, генерация ответа.

5. **Telegram Bot (Frontend)** - Пользователь задаёт вопрос через Telegram. Бот получает сообщение и передаёт его в backend.

<img src="reports/figures/rag_architecture.png" alt="difficulty level" width="400">

# Взаимодействие компонентов


1. Пользователь задаёт вопрос через Telegram. Бот получает сообщение и передаёт его в backend.
2. **Telegram Bot** получает сообщение и отправляет его на Backend API.
3. **Backend API** обрабатывает запрос: 
    - Передаёт текст в **QuestionUnderstanding**, чтобы определить intent, entities и уточнённый запрос (clarified_query).
    - Получает структурированный JSON с информацией о запросе.
4. **Retriever** получает clarified_query и ищет наиболее релевантные чанки в FAISS-индексе:
    - С помощью Embedder текст запроса преобразуется в вектор.
    - FAISS индекс возвращает топ-k ближайших векторов.
5. **Generator** (Mistral LLM) получает:
    - Уточнённый запрос.
    - Релевантные текстовые блоки из Retriever.
    - Генерирует ответ, строго опираясь на найденные данные.
6. **Backend API** отправляет ответ обратно в Telegram Bot.
7. **Telegram Bot** отображает пользователю сформированный ответ.

## Структура репозитория

Репозиторий организован следующим образом:

- [`research/`](research) - основные исследовательские материалы и Jupyter ноутбуки с экспериментами
- [`datasets_analysis/`](datasets_analysis) - анализ доступных датасетов и подготовка данных
- [`baselines/`](baselines) - реализация базовых подходов и методов для сравнения
- [`reports/`](reports) - отчеты о результатах исследований и выводы
- [`team-repo/AI guide/`](team-repo/) - код основного решения (RAG-pipeline) с инструкцией по запуску

## Research

Директорию [`research/`](research) лучше всего просматривать, используя [Obsidian](https://obsidian.md/). Для просмотра нужно:
1. Клонировать репозиторий
2. Установить Obsidian и запустить
3. В меню выбрать "Открыть существующую папку как Vault"
4. Указать путь до директории **research/**.

### Структура

- [`datasets/`](research/datasets) – обзор релевантных датасетов
- [`domain/`](research/domain) – изучение целевой аудитории и трендов в сфере путешествий
- [`existing_solutions/`](research/existing_solutions) – обзор существующих решений на рынке
- [`schemes/`](research/schemes) – наброски архитектуры решения

## Цель репозитория

Этот репозиторий служит для:
- Исследования и разработки алгоритмов обогащения туристического контента
- Анализа и подготовки данных для обучения моделей
- Экспериментирования с различными подходами к генерации культурно значимой информации
- Оценки эффективности разных методов и моделей
- Документирования процесса разработки и полученных результатов
- Тестирование компонентов

## Продуктивизация решения


### 1. Подготовка инфраструктуры

#### Выбор и настройка сервера

- **VPS провайдер:** Timeweb
- **Конфигурация:**
  - CPU: 4 vCPU
  - RAM: 8GB
  - Storage: 80GB SSD
  - OS: Ubuntu 24.04 LTS
- **Регион:** Амстердам (для более стабильной работы LLM)
- **Доступ:** SSH (порт 22)

---

### 2. Настройка безопасности

### Firewall (UFW)

Настроены правила файрвола для защиты сервера:

- **Порт 22 (SSH)** - удалённый доступ к серверу
- **Порт 8001 (RAG API)** - доступ к API сервису
-  **Остальные порты** - заблокированы
```bash
ufw allow 22/tcp comment 'SSH'
ufw allow 8001/tcp comment 'RAG API'
ufw enable
```

---

### 3. Установка необходимого ПО

#### Установленное программное обеспечение

| ПО | Версия | Назначение |
|----|--------|------------|
| Docker | 29.1.3 | Контейнеризация |
| Docker Compose | 5.0.0 | Оркестрация контейнеров |
| Git | latest | Работа с репозиторием |
| Screen | latest | Управление сессиями |

**Утилиты:** htop, nano, curl, wget

---

### 4. Развёртывание проекта

#### Клонирование репозитория
```bash
git clone https://github.com/exxyyf/ai-adventure-guide-dth.git
cd ai-adventure-guide-dth/ai_guide
```

#### Настройка переменных окружения (.env)
```env
MISTRAL_API_KEY=<ключ для Mistral AI API>
HF_TOKEN=<токен HuggingFace для загрузки моделей>
TELEGRAM_BOT_TOKEN=<токен Telegram бота>
RAG_API_URL=http://travel-rag-app:8001
LOG_LEVEL=INFO
```

#### Загрузка данных

Скачаны и распакованы файлы базы знаний:

- `wikivoyage.index` - индекс FAISS для векторного поиска
- `embeddings.npy` - векторные представления текстов
- `metadata.json` - метаданные документов
- `chunked_texts.pkl` - текстовые фрагменты

**Объём данных:** ~2 GB

---

### 5. Сборка и запуск сервисов

#### Docker Compose конфигурация

Развёрнуто 2 контейнера:

1. **travel-rag-app**
   - FastAPI сервер с RAG системой
   - Порт: 8001
   - Компоненты: FAISS, Mistral AI, Sentence Transformers

2. **travel-telegram-bot**
   - Telegram бот для взаимодействия с пользователями
   - Подключение к RAG API

**Сеть:** bridge network для связи между контейнерами

#### Команды запуска
```bash
docker compose build
docker compose up -d
```

---

### 6. Настройка автозапуска и надёжности

#### Systemd service (ai-travel-guide.service)

Создан systemd сервис для автоматического запуска:

- Автоматический запуск контейнеров при загрузке сервера
- Управление через `systemctl`
- Интеграция с Docker daemon
```bash
systemctl enable ai-travel-guide
systemctl start ai-travel-guide
```

#### Docker restart policy

Настроена политика автоматического перезапуска:

- Политика: `unless-stopped` для обоих контейнеров
- Автоматический перезапуск при падении сервисов
- Защита от сбоев

---

### 7. Тестирование

#### Проведённые проверки

| Тест | Команда | Результат |
|------|---------|-----------|
| API endpoint | `curl http://localhost:8001/` | Работает |
| Логи контейнеров | `docker compose logs -f` | Без ошибок |
| Telegram бот | Отправка сообщений | Отвечает корректно |
| Автозапуск | `reboot` | Контейнеры запустились |

**Результат:** Все сервисы работают стабильно, автозапуск функционирует корректно.

---

### 8. Архитектура развёрнутого решения
```
┌─────────────────────────────────────┐
│   VPS Server (Ubuntu 24.04)         │
│   ┌─────────────────────────────┐   │
│   │   Docker Environment        │   │
│   │                             │   │
│   │   ┌───────────────────┐     │   │
│   │   │  RAG API          │     │   │
│   │   │  (FastAPI)        │     │   │
│   │   │  Port: 8001       │     │   │
│   │   │  - FAISS Search   │     │   │
│   │   │  - Mistral AI     │     │   │
│   │   └───────┬───────────┘     │   │
│   │           │                 │   │
│   │   ┌───────▼───────────┐     │   │
│   │   │  Telegram Bot     │     │   │
│   │   │  (Python)         │     │   │
│   │   └───────────────────┘     │   │
│   │                             │   │
│   │   Data Volume:              │   │
│   │   - wikivoyage.index        │   │
│   │   - embeddings.npy          │   │
│   └─────────────────────────────┘   │
│                                     │
│   Systemd: ai-travel-guide.service  │
│   Firewall: UFW (22, 8001)          │
└─────────────────────────────────────┘
```

---

### 9. Используемые технологии

#### Backend

- **FastAPI** - современный веб-фреймворк для Python
- **FAISS** - векторная база данных для similarity search
- **Sentence Transformers** - генерация embeddings
- **Mistral AI** - языковая модель для генерации ответов

#### Infrastructure

- **Docker & Docker Compose** - контейнеризация и оркестрация
- **Ubuntu 24.04** - операционная система
- **Systemd** - управление сервисами
- **UFW** - файрвол

#### Integration

- **Telegram Bot API** - пользовательский интерфейс
- **HuggingFace** - загрузка ML моделей

---

### 10. Команды для управления

#### Просмотр статуса
```bash
docker compose ps
systemctl status ai-travel-guide
```

#### Логи
```bash
docker compose logs -f
```

#### Перезапуск
```bash
systemctl restart ai-travel-guide
```

#### Обновление
```bash
git pull
docker compose build
docker compose up -d
```

---

## Связь с основным проектом

Исходный код основного приложения AI Adventure Guide находится в отдельном репозитории.  Результаты и выводы из этого исследовательского репозитория служат основой для разработки производственной версии системы.

Репозиторий с исходным кодом для деплоя доступен по ссылке:
https://github.com/Levliv/AI-travel-guide

## Лицензия

Проект распространяется под лицензией MIT.  Подробнее см. файл LICENSE. 

## Автор

Команда DreamTeamHouse
